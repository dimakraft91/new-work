<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Локальный VSL Плеер</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Стили плеера */
        .smartplayer-container {
            position: relative;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
            background: #000;
        }
        
        .smartplayer-video {
            width: 100%;
            height: auto;
            display: block;
            background: #000;
        }
        
        /* Контролы */
        .smartplayer-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .smartplayer-container:hover .smartplayer-controls {
            opacity: 1;
        }
        
        .smartplayer-button {
            background: rgba(0, 135, 255, 0.8);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        /* Прогресс-бар */
        .smartplayer-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .smartplayer-progress-bar {
            height: 100%;
            background: #0087ff;
            width: 0%;
            transition: width 0.1s;
        }
        
        /* Fake progress bar */
        .smartplayer-fake-progress {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(0, 135, 255, 0.2);
            display: none;
        }
        
        .smartplayer-fake-progress-bar {
            height: 100%;
            background: #0087ff;
            width: 0%;
            animation: fakeProgress 5s linear infinite;
        }
        
        @keyframes fakeProgress {
            0% { width: 0%; }
            50% { width: 50%; }
            100% { width: 100%; }
        }
        
        /* Оверлей автовоспроизведения */
        .autoplay-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 27, 89, 0.86);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            display: none;
            border-radius: 8px;
            border: 2px solid #FFFFFF;
        }
        
        .autoplay-text {
            color: #FFFFFF;
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            font-family: Arial, sans-serif;
        }
        
        .autoplay-button {
            color: #FFFFFF;
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-top: 20px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        .autoplay-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Loading спиннер */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(farthest-side, #E50914 94%, #0000) top/8px 8px no-repeat,
                      conic-gradient(#0000 30%, #E50914);
            -webkit-mask: radial-gradient(farthest-side, #0000 calc(100% - 8px), #000 0);
            animation: spinnerAnimation 0.75s infinite linear;
        }
        
        .loading-percentage {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            margin-top: 20px;
            font-family: Arial, Helvetica, sans-serif;
        }
        
        @keyframes spinnerAnimation {
            100% { transform: rotate(1turn); }
        }
        
        /* Миниатюра */
        .thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            cursor: pointer;
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(0, 135, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
        }
        
        /* Адаптивность */
        @media (max-width: 450px) {
            .smartplayer-container {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Контейнер плеера -->
    <div class="smartplayer-container" id="vid-6967e06a16e3821ec3e1f275">
        <!-- Fake progress bar (для создания срочности) -->
        <div class="smartplayer-fake-progress" id="fakeProgress">
            <div class="smartplayer-fake-progress-bar"></div>
        </div>
        
        <!-- Основное видео -->
        <video class="smartplayer-video" id="mainVideo" playsinline>
            <!-- Видео будет установлено через JavaScript -->
            Ваш браузер не поддерживает видео.
        </video>
        
        <!-- Оверлей автовоспроизведения -->
        <div class="autoplay-overlay" id="autoplayOverlay">
            <div class="autoplay-text">Die Video-Wiedergabe läuft!</div>
            <!-- SVG иконка play (локальная версия) -->
            <svg width="100" height="70" viewBox="0 0 100 70" style="margin: 20px 0;">
                <path fill="#FFFFFF" d="M80,35 L30,10 L30,60 Z" />
            </svg>
            <div class="autoplay-button" onclick="startAutoplay()">Jetzt anhören</div>
        </div>
        
        <!-- Loading спиннер -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-percentage" id="loadingPercent">0%</div>
        </div>
        
        <!-- Миниатюра -->
        <div class="thumbnail-overlay" id="thumbnailOverlay" onclick="playVideo()">
            <div class="play-button">▶</div>
        </div>
        
        <!-- Прогресс-бар -->
        <div class="smartplayer-progress">
            <div class="smartplayer-progress-bar" id="progressBar"></div>
        </div>
        
        <!-- Контролы -->
        <div class="smartplayer-controls">
            <button class="smartplayer-button" onclick="togglePlay()" id="playButton">⏸</button>
            <button class="smartplayer-button" onclick="toggleFullscreen()">⛶</button>
        </div>
    </div>

    <script>
        // Конфигурация плеера (аналогичная оригинальной)
        const playerConfig = {
            id: "6967e06a16e3821ec3e1f275",
            video: {
                // ЗДЕСЬ УКАЖИТЕ ПУТЬ К ВАШЕМУ ЛОКАЛЬНОМУ ВИДЕО
                src: "ваше-видео.mp4",
                poster: "ваша-обложка.jpg", // опционально
                cover: "ваша-обложка.jpg", // опционально
                aspectRatio: 1.3333,
                height: 1440,
                width: 1080
            },
            playerInit: {
                aspectRatio: 133.33,
                thumbnailKey: "ваша-миниатюра.jpg", // опционально
                verticalVideo: true
            },
            fakeBar: {
                active: true,
                color: "#0087ff",
                height: 10
            },
            smartAutoPlay: {
                active: true,
                startAt: 0,
                endAt: 307
            },
            style: {
                background: "transparent",
                progressBar: false
            },
            thumbsniper: {
                active: true,
                items: [{
                    id: "thumbsniper_1",
                    // ЗДЕСЬ УКАЖИТЕ ПУТЬ К ВАШЕМУ GIF ДЛЯ ПРЕВЬЮ
                    image: "ваш-gif-превью.gif",
                    start: 0,
                    finish: 740
                }]
            }
        };

        // Элементы DOM
        const video = document.getElementById('mainVideo');
        const container = document.getElementById('vid-6967e06a16e3821ec3e1f275');
        const fakeProgress = document.getElementById('fakeProgress');
        const autoplayOverlay = document.getElementById('autoplayOverlay');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingPercent = document.getElementById('loadingPercent');
        const thumbnailOverlay = document.getElementById('thumbnailOverlay');
        const progressBar = document.getElementById('progressBar');
        const playButton = document.getElementById('playButton');

        // Состояние плеера
        let playerState = {
            isPlaying: false,
            isLoading: true,
            hasStarted: false,
            autoplayTriggered: false,
            currentTime: 0,
            duration: 0
        };

        // Инициализация плеера
        function initPlayer() {
            // Устанавливаем видео источник
            video.src = playerConfig.video.src;
            video.style.aspectRatio = playerConfig.video.aspectRatio;
            
            // Устанавливаем постер если есть
            if (playerConfig.video.poster) {
                video.poster = playerConfig.video.poster;
                thumbnailOverlay.style.backgroundImage = `url('${playerConfig.video.poster}')`;
            }
            
            // Настраиваем контейнер
            container.style.paddingTop = playerConfig.playerInit.aspectRatio + '%';
            
            // События видео
            video.addEventListener('loadeddata', onVideoLoaded);
            video.addEventListener('timeupdate', onTimeUpdate);
            video.addEventListener('ended', onVideoEnded);
            video.addEventListener('play', onPlay);
            video.addEventListener('pause', onPause);
            video.addEventListener('waiting', onWaiting);
            video.addEventListener('canplay', onCanPlay);
            
            // Симуляция загрузки
            simulateLoading();
            
            // Запускаем fake progress bar если включен
            if (playerConfig.fakeBar.active) {
                setTimeout(() => {
                    fakeProgress.style.display = 'block';
                }, 1000);
            }
        }

        // Симуляция загрузки (как в оригинале)
        function simulateLoading() {
            let percent = 0;
            const interval = setInterval(() => {
                percent += 2;
                loadingPercent.textContent = percent + '%';
                
                if (percent >= 100) {
                    clearInterval(interval);
                    loadingOverlay.style.display = 'none';
                    playerState.isLoading = false;
                    
                    // Показываем автовоспроизведение если включено
                    if (playerConfig.smartAutoPlay.active && !playerState.hasStarted) {
                        setTimeout(showAutoplayOverlay, 500);
                    }
                }
            }, 30);
        }

        // Показать оверлей автовоспроизведения
        function showAutoplayOverlay() {
            if (playerState.autoplayTriggered) return;
            
            autoplayOverlay.style.display = 'flex';
            playerState.autoplayTriggered = true;
            
            // Автоматически скрываем через 5 секунд
            setTimeout(() => {
                if (autoplayOverlay.style.display === 'flex') {
                    startAutoplay();
                }
            }, 5000);
        }

        // Начать автовоспроизведение
        function startAutoplay() {
            autoplayOverlay.style.display = 'none';
            playVideo();
            
            // Скрываем fake progress bar
            fakeProgress.style.display = 'none';
        }

        // Управление воспроизведением
        function playVideo() {
            video.play().catch(e => {
                console.log('Автовоспроизведение заблокировано:', e);
                // Fallback - показываем кнопку play
                thumbnailOverlay.style.display = 'block';
            });
        }

        function togglePlay() {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    console.log(`Ошибка полноэкранного режима: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Обработчики событий
        function onVideoLoaded() {
            playerState.duration = video.duration;
            thumbnailOverlay.style.display = 'block';
        }

        function onTimeUpdate() {
            playerState.currentTime = video.currentTime;
            const progress = (video.currentTime / video.duration) * 100;
            progressBar.style.width = progress + '%';
            
            // Показываем Thumbsniper GIF в определенные моменты
            if (playerConfig.thumbsniper.active) {
                playerConfig.thumbsniper.items.forEach(item => {
                    if (video.currentTime >= item.start && video.currentTime <= item.finish) {
                        // Можно показывать превью-гифку поверх видео
                        // Реализуйте по необходимости
                    }
                });
            }
            
            // Скрываем thumbnail после начала воспроизведения
            if (video.currentTime > 1) {
                thumbnailOverlay.style.display = 'none';
            }
        }

        function onVideoEnded() {
            playButton.textContent = '▶';
            playerState.isPlaying = false;
            // Можно показать CTA или предложить пересмотреть
        }

        function onPlay() {
            playButton.textContent = '⏸';
            playerState.isPlaying = true;
            playerState.hasStarted = true;
            thumbnailOverlay.style.display = 'none';
        }

        function onPause() {
            playButton.textContent = '▶';
            playerState.isPlaying = false;
        }

        function onWaiting() {
            // Показываем индикатор загрузки если буферизация
        }

        function onCanPlay() {
            // Видео готово к воспроизведению
        }

        // Горячие клавиши
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    togglePlay();
                    break;
                case 'f':
                    toggleFullscreen();
                    break;
                case 'm':
                    video.muted = !video.muted;
                    break;
            }
        });

        // Аналитика просмотра (локальное хранение)
        function trackViewingData() {
            const viewingData = {
                timestamp: new Date().toISOString(),
                videoId: playerConfig.id,
                currentTime: playerState.currentTime,
                duration: playerState.duration,
                progress: (playerState.currentTime / playerState.duration * 100).toFixed(1)
            };
            
            // Сохраняем в localStorage
            const history = JSON.parse(localStorage.getItem('vslViewingHistory') || '[]');
            history.push(viewingData);
            localStorage.setItem('vslViewingHistory', JSON.stringify(history.slice(-100))); // Храним 100 записей
        }

        // Автосохранение каждые 10 секунд
        setInterval(trackViewingData, 10000);

        // Запускаем плеер при загрузке страницы
        window.addEventListener('DOMContentLoaded', initPlayer);

        // Предотвращаем контекстное меню на видео
        video.addEventListener('contextmenu', (e) => e.preventDefault());

        // Адаптация под мобильные устройства
        function checkMobile() {
            const isMobile = /Mobile|Android|iP(hone|od|ad)/.test(navigator.userAgent);
            if (isMobile) {
                container.style.maxWidth = '100%';
                // Дополнительные настройки для мобильных
            }
        }

        checkMobile();
    </script>

    <!-- Дополнительные скрипты для расширенного функционала -->
    <script>
        // Локальный Thumbsniper (показ превью при наведении на прогресс-бар)
        function initThumbsniper() {
            const progress = document.querySelector('.smartplayer-progress');
            
            progress.addEventListener('mousemove', (e) => {
                if (!playerConfig.thumbsniper.active) return;
                
                const rect = progress.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percent = x / rect.width;
                const time = percent * playerState.duration;
                
                // Находим соответствующий Thumbsniper элемент
                const thumbsniper = playerConfig.thumbsniper.items.find(item => 
                    time >= item.start && time <= item.finish
                );
                
                if (thumbsniper) {
                    // Показываем превью
                    showThumbsniperPreview(thumbsniper.image, x);
                }
            });
            
            progress.addEventListener('mouseleave', () => {
                hideThumbsniperPreview();
            });
        }
        
        function showThumbsniperPreview(imageUrl, positionX) {
            // Создаем или обновляем элемент превью
            let preview = document.getElementById('thumbsniper-preview');
            if (!preview) {
                preview = document.createElement('div');
                preview.id = 'thumbsniper-preview';
                preview.style.cssText = `
                    position: absolute;
                    background: #000;
                    border: 2px solid #fff;
                    border-radius: 4px;
                    overflow: hidden;
                    z-index: 100;
                    display: none;
                `;
                document.body.appendChild(preview);
            }
            
            preview.style.left = (positionX - 60) + 'px';
            preview.style.bottom = '50px';
            preview.innerHTML = `<img src="${imageUrl}" style="width:120px; height:auto; display:block;">`;
            preview.style.display = 'block';
        }
        
        function hideThumbsniperPreview() {
            const preview = document.getElementById('thumbsniper-preview');
            if (preview) {
                preview.style.display = 'none';
            }
        }
        
        // Инициализируем Thumbsniper после загрузки
        setTimeout(initThumbsniper, 1000);
        
        // Локальное резюме просмотра (как в оригинале)
        function initResumeFeature() {
            const lastWatch = localStorage.getItem(`vsl_last_watch_${playerConfig.id}`);
            if (lastWatch) {
                const data = JSON.parse(lastWatch);
                if (data.time > 10) { // Если смотрели больше 10 секунд
                    // Можно показать диалог продолжения просмотра
                    // Реализуйте по необходимости
                }
            }
        }
        
        // Сохраняем время просмотра при закрытии
        window.addEventListener('beforeunload', () => {
            localStorage.setItem(`vsl_last_watch_${playerConfig.id}`, JSON.stringify({
                time: playerState.currentTime,
                date: new Date().toISOString()
            }));
        });
        
        initResumeFeature();
    </script>
</body>
</html>